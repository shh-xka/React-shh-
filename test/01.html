<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
    <button id="btn1">按钮1</button>
    <button id="btn2">按钮2</button>
    <script src="https://cdn.bootcss.com/axios/0.19.0/axios.min.js"></script>
    <script>
      const btn1 = document.getElementById('btn1')
      const btn2 = document.getElementById('btn2')

     const axiosInstance = axios.create({
       baseURL:'http://localhost:5000/api',
       timeout:5000,
       headers:{

       }
     })
     let token = ''
    axiosInstance.interceptors.request.use(
      (config)=>{
        if(config.method === 'post' ){
            config.headers['Content-Type'] = 'application/x-www-form-urlencoded'
            config.data = Object.keys(config.data).reduce((prev,key)=>{
                const vaule = config.data[key]
                return prev + `&${key}=${vaule}`
            },'').substring(1)
        }
        if(token){
          config.headers.authorization = 'Bearer ' + token;
        }
        return config
      }
    )

    axiosInstance.interceptors.response.use(
      (response)=>{
        if(response.data.status === 0){
          return response.data.data
        }else{
          alert(response.data.msg)
          return Promise.reject(response.data.msg)
        }
     },
        (error)=>{
              const codeMessage={
                401:'没有权限访问',
                403:'禁止访问',
                404:'页面没有找到',
                500:'服务器故障'
              }

              let errorMessage = ''

              if(error.response){
                errorMessage = codeMessage[error.response.status]||'未知错误'
              }else{
                  if (error.message.indexOf('Network Error') !== -1) {
                    errorMessage = '请检查网络连接';
                  } else if (error.message.indexOf('timeout') !== -1) {
                    errorMessage = '网络太卡了，请连上wifi重试';
                  } else {
                    errorMessage = '未知错误';
                  }
              }

              alert(errorMessage)
              return Promise.reject(errorMessage)

          }
   
   
     )
   

     reqLogin=(username,password)=>{
       return axiosInstance({
              method: 'POST',
              url: '/login',
              data: {
                username,
                password
              },
            })
     }
  
      btn1.onclick = function () {
        reqLogin('admin','admin')
          .then((response) => {
            console.log(response.token)
            token = response.token
          })
        
      }
  
      btn2.onclick = function () {
        axiosInstance({
            method: 'GET',
            url: '/user/get',
          })
          .then((response) => {
           console.log(response)
          })
         
      }
  
     
    </script>
</body>
</html>